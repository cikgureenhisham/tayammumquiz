<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أديك تيمم - Jawi Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; background: #fff9c4; font-family: 'Amiri', serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        canvas { border: 10px solid #fff; border-radius: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        h1 { font-size: 2.5rem; color: #f57f17; margin: 10px 0; direction: rtl; }
    </style>
</head>
<body>

    <h1>✨ تيمم ✨</h1>

<script>
let video;
let faceMesh;
let faces = [];
let gameState = "START"; 
let currentQ = 0;
let score = 0;
let feedback = "";
let feedbackColor;

const quiz = [
    { q: "اڤاكه مقصود تيمم؟", a: "ساڤو دبو كـموك دان تاڠن", b: "باسوه مـوك دڠن اءير", ans: "left" },
    { q: "سبب دشرطكن تيمم؟", a: "مالس امبيل وضوء", b: "كتياداءن اءير / ساكيت", ans: "right" },
    { q: "ماناكه روكون تيمم؟", a: "نية دان مپاڤو دبو", b: "ممباسوه تليڠا", ans: "left" },
    { q: "ڤركارا سنة تيمم؟", a: "مڠهادڤ قبلة", b: "مپاڤو كاكي", ans: "left" },
    { q: "مپاڤو دبو كتاڠن هيڠݢ...", a: "باهو", b: "سيكو", ans: "right" }
];

function preload() {
    // Memastikan model ml5 dimuatkan
    faceMesh = ml5.faceMesh({ maxFaces: 1, flipped: true });
}

function setup() {
    let canvas = createCanvas(640, 480);
    video = createCapture(VIDEO, { flipped: true });
    video.size(640, 480);
    video.hide();

    faceMesh.detectStart(video, (results) => {
        faces = results;
    });
    
    textAlign(CENTER, CENTER);
}

function draw() {
    image(video, 0, 0, width, height);
    background(255, 255, 255, 160); 

    if (gameState === "START") drawStart();
    else if (gameState === "PLAY") drawPlay();
    else if (gameState === "END") drawEnd();
    
    if (feedback !== "") {
        fill(feedbackColor);
        rect(0, 0, width, height);
        fill(255);
        textSize(80);
        text(feedback, width/2, height/2);
    }
}

function drawStart() {
    fill(255, 150, 0, 200);
    rect(0, 0, width, height);
    fill(255);
    textSize(50);
    text("تيمم چڤت!", width/2, height/2 - 40);
    textSize(22);
    text("ݢرقكن كڤالا ككيري اتاو ككانن", width/2, height/2 + 20);
    text("[ كليق سكرين اونتوق مـولا ]", width/2, height/2 + 80);
}

function drawPlay() {
    let data = quiz[currentQ];
    fill(255);
    rect(50, 20, 540, 90, 25);
    fill(0);
    textSize(30);
    text(data.q, width/2, 65);

    drawBox(60, 350, data.a, "#ec407a"); 
    drawBox(360, 350, data.b, "#26a69a"); 

    if (faces.length > 0) {
        let nose = faces[0].keypoints[1];
        fill(255, 235, 59);
        stroke(255, 152, 0);
        strokeWeight(3);
        ellipse(nose.x, nose.y, 45, 45); // Karakter kuning di hidung
        
        if (nose.x < 180) checkAns("left");
        if (nose.x > 460) checkAns("right");
    }
}

function drawBox(x, y, txt, col) {
    fill(col);
    rect(x, y, 220, 110, 20);
    fill(255);
    textSize(20);
    textWrap(WORD);
    text(txt, x + 10, y + 10, 200, 90);
}

function checkAns(side) {
    if (feedback !== "") return;
    if (side === quiz[currentQ].ans) {
        score++;
        feedback = "بتول!";
        feedbackColor = color(76, 175, 80, 200);
    } else {
        feedback = "ساله!";
        feedbackColor = color(244, 67, 54, 200);
    }
    setTimeout(() => {
        feedback = "";
        currentQ++;
        if (currentQ >= quiz.length) gameState = "END";
    }, 1500);
}

function drawEnd() {
    fill(0, 150, 136, 220);
    rect(0, 0, width, height);
    fill(255);
    textSize(60);
    text("تـمـت!", width/2, height/2 - 40);
    textSize(30);
    text("سكور اندا: " + score + " / " + quiz.length, width/2, height/2 + 40);
    textSize(18);
    text("كليق اونتوق مـاءين لاݢي", width/2, height/2 + 100);
}

function mousePressed() {
    if (gameState !== "PLAY") {
        currentQ = 0; score = 0; gameState = "PLAY";
    }
}
</script>
</body>
</html>
