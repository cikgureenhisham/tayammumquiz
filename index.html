<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>أديك تيمم - HD Reels Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; padding: 0; background: #000; 
            font-family: 'Amiri', serif; overflow: hidden; 
            touch-action: none; display: flex; 
            justify-content: center; align-items: center; height: 100vh; 
        }
        canvas { border-radius: 20px; box-shadow: 0 0 50px rgba(255,255,255,0.1); }
    </style>
</head>
<body>

<script>
let video;
let faceMesh;
let faces = [];
let gameState = "START"; 
let currentQ = 0;
let score = 0;
let feedback = "";
let particles = [];

const quiz = [
    { q: "اڤاكه مقصود تيمم؟", a: "ساڤو دبو كـموك دان تاڠن", b: "باسوه مـوك دڠن اءير", ans: "left" },
    { q: "سبب دشرطكن تيمم؟", a: "مالس امبيل وضوء", b: "كتياداءن اءير / ساكيت", ans: "right" },
    { q: "ماناكه روكون تيمم؟", a: "نية دان مپاڤو دبو", b: "ممباسوه تليڠا", ans: "left" },
    { q: "ڤركارا سنة تيمم؟", a: "مڠهادڤ قبلة", b: "مپاڤو كاكي", ans: "left" },
    { q: "مپاڤو دبو كتاڠن هيڠݢ...", a: "باهو", b: "سيكو", ans: "right" }
];

function preload() {
    faceMesh = ml5.faceMesh({ maxFaces: 1, flipped: true });
}

function setup() {
    // Tetapkan saiz 9:16 mengikut ketinggian skrin
    let h = windowHeight * 0.95;
    let w = (h * 9) / 16;
    
    if (w > windowWidth) {
        w = windowWidth * 0.9;
        h = (w * 16) / 9;
    }
    
    createCanvas(w, h);
    
    // Kamera HD
    video = createCapture(VIDEO, { flipped: true });
    video.size(640, 480);
    video.hide();

    faceMesh.detectStart(video, (results) => { faces = results; });
    textAlign(CENTER, CENTER);
}

function draw() {
    background(0);
    
    // PAPARAN KAMERA JELAS (TANPA LAYER)
    let aspect = 9/16;
    let sw = video.height * aspect;
    let sx = (video.width - sw) / 2;
    image(video, 0, 0, width, height, sx, 0, sw, video.height);

    if (gameState === "START") drawStart();
    else if (gameState === "PLAY") drawPlay();
    else if (gameState === "END") drawEnd();

    // Lukis Partikel Kemenangan
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].show();
        if (particles[i].finished()) particles.splice(i, 1);
    }
}

function drawStart() {
    // Overlay gelap sedikit hanya pada skrin mula
    fill(0, 0, 0, 100);
    rect(0, 0, width, height);
    
    fill("#FFD700");
    textSize(width * 0.2);
    text("✨", width/2, height/2 - 100);
    
    fill(255);
    textSize(width * 0.12);
    text("أديق تيمم", width/2, height/2 - 20);
    
    textSize(width * 0.05);
    text("ݢرق كڤالا اونتوق مميليه", width/2, height/2 + 40);
    
    // Butang IG Style
    fill("#E1306C");
    noStroke();
    rect(width*0.2, height/2 + 100, width*0.6, 50, 25);
    fill(255);
    text("مـولا مـاءين", width/2, height/2 + 125);
}

function drawPlay() {
    let data = quiz[currentQ];
    
    // KAD SOALAN DENGAN BAYANG (SHADOW)
    push();
    drawingContext.shadowBlur = 20;
    drawingContext.shadowColor = 'rgba(0,0,0,0.5)';
    fill(255, 255, 255, 240);
    noStroke();
    rect(width*0.05, height*0.1, width*0.9, height*0.15, 15);
    pop();
    
    fill("#222");
    textSize(width * 0.06);
    text(data.q, width/2, height*0.17);

    // SKOR
    fill(255);
    drawingContext.shadowBlur = 5;
    text("سكور: " + score, width/2, height * 0.05);

    // KOTAK JAWAPAN (FLOATING)
    drawIGBox(width*0.05, height*0.75, data.a, "#E1306C");
    drawIGBox(width*0.52, height*0.75, data.b, "#405DE6");

    // POINTER BINTANG (STAR)
    if (faces.length > 0) {
        let nose = faces[0].keypoints[1];
        let aspect = 9/16;
        let sw = video.height * aspect;
        let sx = (video.width - sw) / 2;
        let nx = map(nose.x, sx, sx + sw, 0, width);
        let ny = map(nose.y, 0, video.height, 0, height);
        
        fill(255, 235, 59);
        textSize(width * 0.12);
        text("⭐", nx, ny);
        
        if (nx < width * 0.35) checkAns("left");
        if (nx > width * 0.65) checkAns("right");
    }
    
    if (feedback !== "") {
        fill(255);
        textSize(width * 0.25);
        text(feedback, width/2, height/2);
    }
}

function drawIGBox(x, y, txt, col) {
    push();
    drawingContext.shadowBlur = 15;
    drawingContext.shadowColor = 'rgba(0,0,0,0.3)';
    fill(col);
    rect(x, y, width*0.43, height*0.15, 15);
    fill(255);
    textSize(width * 0.045);
    textWrap(WORD);
    text(txt, x + 5, y + 5, width*0.4, height*0.13);
    pop();
}

function checkAns(side) {
    if (feedback !== "") return;
    if (side === quiz[currentQ].ans) {
        score++;
        feedback = "✅";
        for(let i=0; i<30; i++) particles.push(new Particle(width/2, height/2, "#4caf50"));
    } else {
        feedback = "❌";
    }
    setTimeout(() => {
        feedback = "";
        currentQ++;
        if (currentQ >= quiz.length) gameState = "END";
    }, 1200);
}

function drawEnd() {
    fill(0, 0, 0, 180);
    rect(0,0,width,height);
    fill("#FFD700");
    textSize(width * 0.15);
    text("تـمـت!", width/2, height/2 - 50);
    fill(255);
    textSize(width * 0.08);
    text("سكور: " + score + " / " + quiz.length, width/2, height/2 + 20);
    textSize(width * 0.04);
    text("كليق اونتوق مـاءين لاݢي", width/2, height/2 + 100);
}

function mousePressed() { 
    if (gameState !== "PLAY") { 
        currentQ = 0; score = 0; gameState = "PLAY"; 
    } 
}

class Particle {
    constructor(x, y, col) {
        this.x = x; this.y = y;
        this.vx = random(-5, 5); this.vy = random(-5, 5);
        this.alpha = 255; this.col = col;
    }
    finished() { return this.alpha < 0; }
    update() { this.x += this.vx; this.y += this.vy; this.alpha -= 8; }
    show() { noStroke(); fill(this.col + hex(floor(this.alpha), 2)); ellipse(this.x, this.y, 10); }
}
</script>
</body>
</html>
